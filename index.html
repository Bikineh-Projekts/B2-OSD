<!doctype html>
<html lang="de">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>√ñSD B2 Schreiben - Duale Bewertung (Strenge Version)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        .gradient-header {
            background: linear-gradient(135deg, #1e3a8a 0%, #3730a3 100%);
        }
        
        .pruefer-card {
            animation: slideIn 0.5s ease-out;
            border: 3px solid;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .pruefer-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }
        
        .pruefer-a {
            border-color: #7c3aed;
            background: linear-gradient(to bottom right, #f5f3ff, #ede9fe);
        }
        
        .pruefer-b {
            border-color: #2563eb;
            background: linear-gradient(to bottom right, #eff6ff, #dbeafe);
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        .final-score {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .bestanden {
            background: linear-gradient(135deg, #10b981 0%, #047857 100%);
        }
        
        .nicht-bestanden {
            background: linear-gradient(135deg, #ef4444 0%, #b91c1c 100%);
        }
        
        .correction-highlight {
            background-color: #fef3c7;
            border-left: 4px solid #f59e0b;
            padding: 8px 12px;
            margin: 4px 0;
            border-radius: 0 6px 6px 0;
        }
        
        .severe-penalty {
            background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);
            border: 3px solid #7f1d1d;
            animation: pulse-warning 2s infinite;
        }
        
        @keyframes pulse-warning {
            0%, 100% { opacity: 1; }
            50% { opacity: .8; }
        }
        
        .corrected-version {
            background-color: #f0fdf4;
            border: 3px solid #10b981;
            border-radius: 12px;
        }
        
        .incomplete-text-warning {
            background: linear-gradient(135deg, #f97316 0%, #ea580c 100%);
            border: 3px solid #c2410c;
        }
        
        .stats-card {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            color: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 10px 25px rgba(99, 102, 241, 0.3);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-50 to-blue-50">
    <div id="app" class="min-h-screen">
        <!-- Header mit Statistik -->
        <div class="gradient-header text-white">
            <div class="container mx-auto px-4 py-8">
                <div class="text-center mb-8">
                    <h1 class="text-4xl md:text-5xl font-bold mb-4">√ñSD B2 Dual-Bewertungssystem</h1>
                    <p class="text-sm md:text-base opacity-40">Strenge aber faire Bewertung f√ºr optimale Pr√ºfungsvorbereitung</p>
                </div>
                
                <!-- Statistik Bar -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                    <div class="stats-card text-center">
                        <div class="text-3xl font-bold" id="totalVisits">1,842</div>
                        <div class="text-sm opacity-90">Gesamtbesuche</div>
                    </div>
                    <div class="stats-card text-center">
                        <div class="text-3xl font-bold" id="onlineUsers">12</div>
                        <div class="text-sm opacity-90">Nutzer online</div>
                    </div>
                    <div class="stats-card text-center">
                        <div class="text-3xl font-bold" id="totalEvaluations">487</div>
                        <div class="text-sm opacity-90">Bewertungen</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Container -->
        <div class="container mx-auto px-4 py-8 max-w-6xl">
            <!-- Texteingabe -->
            <div class="bg-white rounded-2xl shadow-xl p-6 mb-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                    <span class="bg-indigo-100 text-indigo-600 w-10 h-10 rounded-full flex items-center justify-center mr-3">‚úçÔ∏è</span>
                    Ihren Text zur Bewertung eingeben
                </h2>
                
                <div class="space-y-6">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">
                            üìå Aufgabenstellung (Pflicht f√ºr genaue Bewertung)
                        </label>
                        <input 
                            type="text" 
                            id="task" 
                            placeholder="Bitte geben Sie die exakte Aufgabenstellung ein..."
                            class="w-full p-4 border-2 border-gray-300 rounded-lg focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 transition-all"
                            required
                        >
                    </div>
                    
                    <!-- WARNUNG: NICHT-DEUTSCHER TEXT -->
                    <div id="languageWarning" class="hidden severe-penalty text-white rounded-2xl p-6 shadow-2xl">
                        <div class="flex items-start gap-4">
                            <div class="text-4xl">‚ö†Ô∏è</div>
                            <div class="flex-1">
                                <h3 class="text-2xl font-extrabold mb-2">ACHTUNG: Text ist nicht auf Deutsch!</h3>
                                <p class="text-lg mb-3">
                                    Dieses Tool funktioniert <strong>ausschlie√ülich f√ºr deutsche Texte</strong> (√ñSD B2 Pr√ºfung).
                                </p>
                                <p class="text-base opacity-90">
                                    Bitte geben Sie einen vollst√§ndigen deutschen Text ein.
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- WARNUNG: UNVOLLST√ÑNDIGER TEXT -->
                    <div id="incompleteWarning" class="hidden incomplete-text-warning text-white rounded-2xl p-6 shadow-2xl">
                        <div class="flex items-start gap-4">
                            <div class="text-4xl">üö®</div>
                            <div class="flex-1">
                                <h3 class="text-2xl font-extrabold mb-2">WARNUNG: Unvollst√§ndiger Text erkannt!</h3>
                                <p class="text-lg mb-3">
                                    <strong id="incompleteReason">Text scheint unvollst√§ndig zu sein.</strong>
                                </p>
                                <p class="text-base opacity-90">
                                    Bitte vervollst√§ndigen Sie Ihren Text f√ºr eine faire Bewertung.
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <div class="flex justify-between items-center mb-2">
                            <label class="block text-sm font-semibold text-gray-700">
                                ‚úçÔ∏è Ihr Text zur Bewertung (mindestens 120 W√∂rter)
                            </label>
                            <div class="text-sm font-semibold">
                                <span id="wordPenaltyInfo" class="hidden text-red-600">‚ö†Ô∏è Wortzahl zu niedrig</span>
                            </div>
                        </div>
                        <textarea 
                            id="textInput" 
                            rows="14"
                            placeholder="Schreiben oder f√ºgen Sie hier Ihren DEUTSCHEN Text ein (mindestens 120 W√∂rter)..."
                            class="w-full p-4 border-2 border-gray-300 rounded-lg focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 transition-all resize-none"
                        ></textarea>
                        <div class="flex justify-between text-sm text-gray-500 mt-1">
                            <span id="charCount">0 Zeichen</span>
                            <span id="wordCount">0 W√∂rter</span>
                            <span id="sentenceCount">0 S√§tze</span>
                        </div>
                        <div id="languageStatus" class="text-xs mt-2 font-semibold"></div>
                        
                        <!-- Wortzahl-Indikator -->
                        <div class="mt-4">
                            <div class="flex justify-between text-sm mb-1">
                                <span>Wortzahl:</span>
                                <span id="wordCountStatus" class="font-bold">Noch nicht ausreichend</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-3">
                                <div id="wordProgress" class="bg-gradient-to-r from-red-500 via-yellow-500 to-green-500 h-3 rounded-full transition-all duration-500" style="width: 0%"></div>
                            </div>
                            <div class="flex justify-between text-xs text-gray-500 mt-1">
                                <span>Unter 120 W√∂rter</span>
                                <span>120-130 W√∂rter</span>
                                <span>√úber 130 W√∂rter</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="text-center">
                        <button 
                            onclick="startBewertung()"
                            id="bewertenBtn"
                            class="px-8 py-4 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-xl font-bold text-lg hover:from-indigo-700 hover:to-purple-700 transition-all shadow-lg hover:shadow-xl transform hover:-translate-y-1 disabled:opacity-50 disabled:cursor-not-allowed"
                        >
                            üéØ Jetzt streng bewerten lassen
                        </button>
                        <p class="text-sm text-gray-600 mt-3">
                            Diese Bewertung ist strenger als die eigentliche √ñSD-Pr√ºfung
                        </p>
                    </div>
                </div>
            </div>

            <!-- Ergebnisse -->
            <div id="results" class="hidden space-y-8">
                <!-- Pr√ºfer A -->
                <div class="pruefer-card pruefer-a rounded-2xl shadow-xl p-8">
                    <div class="flex items-center mb-6">
                        <div class="bg-purple-600 text-white w-12 h-12 rounded-full flex items-center justify-center text-xl font-bold mr-4">
                            A
                        </div>
                        <div>
                            <h2 class="text-2xl font-bold text-purple-900">üë®‚Äçüè´ Pr√ºfer A - Streng nach √ñSD-Kriterien</h2>
                            <p class="text-purple-700">Exakte Bewertung mit null Toleranz</p>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-5 gap-4 mb-6">
                        <div class="text-center bg-white p-4 rounded-lg shadow-sm border border-purple-100">
                            <div class="text-sm text-gray-600 mb-1">Aufgabenbew√§ltigung</div>
                            <div id="prueferA1" class="text-2xl font-bold text-gray-800">0/3</div>
                            <div id="prueferA1_reason" class="text-xs text-gray-500 mt-1"></div>
                        </div>
                        <div class="text-center bg-white p-4 rounded-lg shadow-sm border border-purple-100">
                            <div class="text-sm text-gray-600 mb-1">Kommunikative Angemessenheit</div>
                            <div id="prueferA2" class="text-2xl font-bold text-gray-800">0/3</div>
                            <div id="prueferA2_reason" class="text-xs text-gray-500 mt-1"></div>
                        </div>
                        <div class="text-center bg-white p-4 rounded-lg shadow-sm border border-purple-100">
                            <div class="text-sm text-gray-600 mb-1">Textaufbau</div>
                            <div id="prueferA3" class="text-2xl font-bold text-gray-800">0/3</div>
                            <div id="prueferA3_reason" class="text-xs text-gray-500 mt-1"></div>
                        </div>
                        <div class="text-center bg-white p-4 rounded-lg shadow-sm border border-purple-100">
                            <div class="text-sm text-gray-600 mb-1">Lexik & Ausdruck</div>
                            <div id="prueferA4" class="text-2xl font-bold text-gray-800">0/3</div>
                            <div id="prueferA4_reason" class="text-xs text-gray-500 mt-1"></div>
                        </div>
                        <div class="text-center bg-white p-4 rounded-lg shadow-sm border border-purple-100">
                            <div class="text-sm text-gray-600 mb-1">Formale Richtigkeit</div>
                            <div id="prueferA5" class="text-2xl font-bold text-gray-800">0/3</div>
                            <div id="prueferA5_reason" class="text-xs text-gray-500 mt-1"></div>
                        </div>
                    </div>
                    
                    <div class="bg-white p-6 rounded-xl border border-purple-200">
                        <h3 class="font-bold text-purple-800 mb-3">üìù Detaillierte Begr√ºndung:</h3>
                        <div id="begruendungA" class="text-gray-700 space-y-2">
                            <!-- Wird durch JS bef√ºllt -->
                        </div>
                    </div>
                </div>

                <!-- Pr√ºfer B -->
                <div class="pruefer-card pruefer-b rounded-2xl shadow-xl p-8">
                    <div class="flex items-center mb-6">
                        <div class="bg-blue-600 text-white w-12 h-12 rounded-full flex items-center justify-center text-xl font-bold mr-4">
                            B
                        </div>
                        <div>
                            <h2 class="text-2xl font-bold text-blue-900">üë©‚Äçüè´ Pr√ºfer B - P√§dagogische Perspektive</h2>
                            <p class="text-blue-700">Faire Bewertung mit Entwicklungsempfehlungen</p>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-5 gap-4 mb-6">
                        <div class="text-center bg-white p-4 rounded-lg shadow-sm border border-blue-100">
                            <div class="text-sm text-gray-600 mb-1">Aufgabenbew√§ltigung</div>
                            <div id="prueferB1" class="text-2xl font-bold text-gray-800">0/3</div>
                            <div id="prueferB1_reason" class="text-xs text-gray-500 mt-1"></div>
                        </div>
                        <div class="text-center bg-white p-4 rounded-lg shadow-sm border border-blue-100">
                            <div class="text-sm text-gray-600 mb-1">Kommunikative Angemessenheit</div>
                            <div id="prueferB2" class="text-2xl font-bold text-gray-800">0/3</div>
                            <div id="prueferB2_reason" class="text-xs text-gray-500 mt-1"></div>
                        </div>
                        <div class="text-center bg-white p-4 rounded-lg shadow-sm border border-blue-100">
                            <div class="text-sm text-gray-600 mb-1">Textaufbau</div>
                            <div id="prueferB3" class="text-2xl font-bold text-gray-800">0/3</div>
                            <div id="prueferB3_reason" class="text-xs text-gray-500 mt-1"></div>
                        </div>
                        <div class="text-center bg-white p-4 rounded-lg shadow-sm border border-blue-100">
                            <div class="text-sm text-gray-600 mb-1">Lexik & Ausdruck</div>
                            <div id="prueferB4" class="text-2xl font-bold text-gray-800">0/3</div>
                            <div id="prueferB4_reason" class="text-xs text-gray-500 mt-1"></div>
                        </div>
                        <div class="text-center bg-white p-4 rounded-lg shadow-sm border border-blue-100">
                            <div class="text-sm text-gray-600 mb-1">Formale Richtigkeit</div>
                            <div id="prueferB5" class="text-2xl font-bold text-gray-800">0/3</div>
                            <div id="prueferB5_reason" class="text-xs text-gray-500 mt-1"></div>
                        </div>
                    </div>
                    
                    <div class="bg-white p-6 rounded-xl border border-blue-200">
                        <h3 class="font-bold text-blue-800 mb-3">üìù Entwicklungsempfehlungen:</h3>
                        <div id="begruendungB" class="text-gray-700 space-y-2">
                            <!-- Wird durch JS bef√ºllt -->
                        </div>
                    </div>
                </div>

                <!-- Finale Bewertung -->
                <div class="final-score bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-2xl shadow-xl p-8">
                    <h2 class="text-2xl font-bold mb-6 text-center">üéØ Finale Bewertung & Endentscheidung</h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-5 gap-4 mb-8">
                        <div class="text-center bg-white/20 p-4 rounded-lg">
                            <div class="text-white/90 text-sm mb-1">Aufgabenbew√§ltigung</div>
                            <div id="final1" class="text-3xl font-bold">0/3</div>
                            <div id="final1_note" class="text-xs opacity-75 mt-1"></div>
                        </div>
                        <div class="text-center bg-white/20 p-4 rounded-lg">
                            <div class="text-white/90 text-sm mb-1">Kommunikative Angemessenheit</div>
                            <div id="final2" class="text-3xl font-bold">0/3</div>
                            <div id="final2_note" class="text-xs opacity-75 mt-1"></div>
                        </div>
                        <div class="text-center bg-white/20 p-4 rounded-lg">
                            <div class="text-white/90 text-sm mb-1">Textaufbau</div>
                            <div id="final3" class="text-3xl font-bold">0/3</div>
                            <div id="final3_note" class="text-xs opacity-75 mt-1"></div>
                        </div>
                        <div class="text-center bg-white/20 p-4 rounded-lg">
                            <div class="text-white/90 text-sm mb-1">Lexik & Ausdruck</div>
                            <div id="final4" class="text-3xl font-bold">0/3</div>
                            <div id="final4_note" class="text-xs opacity-75 mt-1"></div>
                        </div>
                        <div class="text-center bg-white/20 p-4 rounded-lg">
                            <div class="text-white/90 text-sm mb-1">Formale Richtigkeit</div>
                            <div id="final5" class="text-3xl font-bold">0/3</div>
                            <div id="final5_note" class="text-xs opacity-75 mt-1"></div>
                        </div>
                    </div>
                    
                    <!-- Wortzahl-Bewertung -->
                    <div class="bg-white/10 rounded-xl p-4 mb-6">
                        <div class="flex justify-between items-center">
                            <div>
                                <div class="text-white/90 text-sm">Wortzahl-Bewertung:</div>
                                <div class="text-lg font-bold" id="wordCountEvaluation"></div>
                            </div>
                            <div id="wordPenaltyBadge" class="px-3 py-1 rounded-full text-sm font-bold"></div>
                        </div>
                        <div class="text-xs text-white/70 mt-2" id="wordCountExplanation"></div>
                    </div>
                    
                    <div class="text-center">
                        <div class="text-4xl font-bold mb-4" id="gesamtPunkte">0/15 PUNKTE</div>
                        <div id="bestandenBox" class="inline-block px-8 py-4 rounded-xl font-bold text-2xl">
                            WIRD BEREICHNET
                        </div>
                        <div class="mt-4 text-white/80 text-sm" id="passingNote"></div>
                    </div>
                </div>

                <!-- Korrigierte Version -->
                <div class="corrected-version rounded-2xl shadow-xl p-8">
                    <h2 class="text-2xl font-bold text-green-800 mb-6 flex items-center">
                        <span class="bg-green-100 text-green-600 w-10 h-10 rounded-full flex items-center justify-center mr-3">‚úèÔ∏è</span>
                        Korrigierte Version Ihres Textes
                    </h2>
                    
                    <div class="p-6 bg-white rounded-lg border border-green-300">
                        <pre id="korrigierteVersion" class="whitespace-pre-wrap text-gray-700 leading-relaxed"></pre>
                        <div class="mt-4 text-sm text-gray-600">
                            <p><strong>Verbesserungen:</strong> Satzzeichen korrigiert, Leerzeichen angepasst, formelle Bausteine erg√§nzt</p>
                        </div>
                    </div>
                </div>

                <!-- Passende Redemittel -->
                <div class="bg-gradient-to-r from-teal-50 to-cyan-50 border-2 border-teal-300 rounded-2xl shadow-xl p-8">
                    <h2 class="text-2xl font-bold text-teal-900 mb-6 flex items-center">
                        <span class="bg-teal-100 text-teal-600 w-10 h-10 rounded-full flex items-center justify-center mr-3">üí¨</span>
                        Individuelle Verbesserungsvorschl√§ge f√ºr IHREN Text
                    </h2>
                    
                    <div id="redemittel" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <!-- Wird durch JS bef√ºllt -->
                    </div>
                </div>

                <!-- Neustart Button -->
                <div class="text-center pt-8">
                    <button 
                        onclick="neustart()"
                        class="px-8 py-3 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-lg font-bold hover:from-indigo-700 hover:to-purple-700 transition-all shadow-lg"
                    >
                        üîÑ Neue Bewertung starten
                    </button>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="bg-gray-900 text-white py-8 mt-12">
            <div class="container mx-auto px-4 text-center">
                <p class="text-lg font-semibold mb-2">√ñSD B2 Dual-Bewertungssystem (Strenge Version)</p>
                <p class="text-gray-400">Strenge Bewertung f√ºr optimale Pr√ºfungsvorbereitung ‚Ä¢ Realistische Punktabz√ºge</p>
                <p class="text-gray-500 text-sm mt-4">
                    Diese Seite wurde erstellt von Milad Bik ‚Ä¢ 
                    <a href="mailto:miladnd01@gmail.com" class="text-cyan-400 hover:text-cyan-300">
                        miladnd01@gmail.com f√ºr Fragen und Unterst√ºtzung
                    </a>
                </p>
                <div class="mt-4 text-xs text-gray-600">
                    <p>‚ÑπÔ∏è Diese Simulation ist absichtlich strenger als die echte √ñSD-Pr√ºfung.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ========= GLOBALE VARIABLEN =========
        let totalVisits = parseInt(localStorage.getItem('totalVisits')) || 1842;
        let onlineUsers = Math.floor(Math.random() * 15) + 8;
        let totalEvaluations = parseInt(localStorage.getItem('totalEvaluations')) || 487;

        // ========= INITIALISIERUNG DER STATISTIK =========
        function initStats() {
            // Erh√∂he Besucherzahl bei jedem Laden
            totalVisits++;
            onlineUsers = Math.floor(Math.random() * 20) + 5;
            
            // Speichere in localStorage
            localStorage.setItem('totalVisits', totalVisits);
            
            // Aktualisiere Anzeige
            document.getElementById('totalVisits').textContent = totalVisits.toLocaleString();
            document.getElementById('onlineUsers').textContent = onlineUsers;
            document.getElementById('totalEvaluations').textContent = totalEvaluations.toLocaleString();
        }

        // ========= TEXTANALYSE FUNKTIONEN =========
        function analyzeTextStructure(text) {
            const analysis = {
                wordCount: 0,
                sentenceCount: 0,
                paragraphCount: 0,
                hasIntroduction: false,
                hasBody: false,
                hasConclusion: false,
                incompleteSentences: 0,
                sentencesWithoutVerb: 0,
                logicalConnectors: 0,
                formalElements: 0,
                taskRelevance: 0,
                isComplete: true,
                completenessScore: 0 // 0-100%
            };
            
            // Grundlegende Statistiken
            analysis.wordCount = text.trim() === '' ? 0 : text.trim().split(/\s+/).length;
            
            // S√§tze z√§hlen (basierend auf Satzzeichen)
            const sentences = text.split(/[.!?]+/).filter(s => s.trim().length > 0);
            analysis.sentenceCount = sentences.length;
            
            // Abs√§tze z√§hlen
            analysis.paragraphCount = text.split(/\n\s*\n/).filter(p => p.trim().length > 0).length;
            
            // Strukturanalyse
            const lines = text.toLowerCase().split('\n');
            analysis.hasIntroduction = lines.some(line => 
                line.includes('einleitung') || 
                line.includes('zun√§chst') || 
                line.includes('in diesem text') ||
                (line.length > 20 && lines.indexOf(line) === 0)
            );
            
            analysis.hasConclusion = lines.some(line => 
                line.includes('zusammenfassung') || 
                line.includes('fazit') || 
                line.includes('abschlie√üend') ||
                line.includes('zusammenfassend') ||
                (line.includes('insgesamt') && lines.indexOf(line) > lines.length * 0.7)
            );
            
            analysis.hasBody = analysis.paragraphCount >= 2;
            
            // Unvollst√§ndige S√§tze erkennen
            sentences.forEach(sentence => {
                const trimmed = sentence.trim();
                // Pr√ºfe auf fehlendes Satzzeichen am Ende
                if (!/[.!?]$/.test(trimmed) && trimmed.length > 10) {
                    analysis.incompleteSentences++;
                }
                
                // Pr√ºfe auf fehlendes Verb (vereinfacht)
                const verbs = ['ist', 'sind', 'war', 'waren', 'hat', 'haben', 'wird', 'werden', 'kann', 'k√∂nnen', 'muss', 'm√ºssen', 'soll', 'sollen'];
                const hasVerb = verbs.some(verb => 
                    new RegExp('\\b' + verb + '\\b', 'i').test(trimmed)
                );
                if (!hasVerb && trimmed.split(' ').length > 3) {
                    analysis.sentencesWithoutVerb++;
                }
            });
            
            // Logische Konnektoren z√§hlen
            const connectors = ['au√üerdem', 'deshalb', 'trotzdem', 'jedoch', 'einerseits', 'andererseits', 
                               'dar√ºber hinaus', 'zudem', 'folglich', 'daher', 'obwohl', 'weil', 'denn'];
            connectors.forEach(connector => {
                const regex = new RegExp('\\b' + connector + '\\b', 'gi');
                const matches = text.match(regex);
                if (matches) analysis.logicalConnectors += matches.length;
            });
            
            // Formale Elemente erkennen
            if (/sehr geehrte|mit freundlichen gr√º√üen|hochachtungsvoll/i.test(text)) {
                analysis.formalElements++;
            }
            
            // Komplettheits-Score berechnen
            let completenessScore = 0;
            
            // Struktur-Bonus
            if (analysis.hasIntroduction) completenessScore += 15;
            if (analysis.hasBody) completenessScore += 30;
            if (analysis.hasConclusion) completenessScore += 15;
            
            // Satzqualit√§t
            if (analysis.sentenceCount >= 5) completenessScore += 20;
            if (analysis.incompleteSentences === 0) completenessScore += 10;
            if (analysis.sentencesWithoutVerb === 0) completenessScore += 10;
            
            analysis.completenessScore = Math.min(100, completenessScore);
            
            // Ist der Text vollst√§ndig?
            analysis.isComplete = analysis.completenessScore >= 60 && 
                                 analysis.wordCount >= 100 &&
                                 analysis.incompleteSentences < analysis.sentenceCount * 0.3;
            
            return analysis;
        }

        function checkTaskRelevance(text, task) {
            if (!task || task.trim().length < 5) return 0.5; // Neutral wenn keine Aufgabe
            
            const textLower = text.toLowerCase();
            const taskLower = task.toLowerCase();
            
            let relevanceScore = 0;
            const taskWords = taskLower.split(/\s+/).filter(w => w.length > 3);
            
            taskWords.forEach(word => {
                if (textLower.includes(word)) relevanceScore++;
            });
            
            return Math.min(1, relevanceScore / Math.max(1, taskWords.length));
        }

        // ========= WORTZAHL-BEWERTUNGSSYSTEM =========
        function calculateWordPenalty(wordCount) {
            if (wordCount >= 120) return { penalty: 0, reason: 'Ausreichende Wortzahl' };
            
            // Progressive Strafe unter 120 W√∂rtern
            if (wordCount >= 110) {
                return { penalty: 0.5, reason: 'Knapp unter dem Limit (110-119 W√∂rter)' };
            } else if (wordCount >= 100) {
                return { penalty: 1, reason: 'Deutlich zu kurz (100-109 W√∂rter)' };
            } else if (wordCount >= 80) {
                return { penalty: 1.5, reason: 'Sehr kurz (80-99 W√∂rter)' };
            } else if (wordCount >= 60) {
                return { penalty: 2, reason: 'Extrem kurz (60-79 W√∂rter)' };
            } else {
                return { penalty: 3, reason: 'Unzureichend (unter 60 W√∂rtern)' };
            }
        }

        // ========= DETEKTION NICHT-DEUTSCHER TEXTE =========
        function detectLanguage(text) {
            if (text.trim().length < 30) return { isGerman: true, confidence: 100 };
            
            const germanIndicators = [
                /\b(ich|du|er|sie|es|wir|ihr|sie|der|die|das|den|dem|des)\b/gi,
                /\b(und|oder|aber|weil|dass|wenn|als|ob|damit|obwohl)\b/gi,
                /\b(ein|eine|einer|eines|einem|einen)\b/gi,
                /[√§√∂√º√ü]/g,
                /\b(meiner|deiner|seiner|ihrer|unserer|eurer|ihrer)\b/gi,
                /\b(mir|dir|ihm|ihr|uns|euch|ihnen)\b/gi
            ];
            
            const englishIndicators = [
                /\b(the|and|for|are|but|not|you|all|any|can|her|was|one|our|out|day|get|has|him|his|how|man|new|now|old|see|two|way|who|boy|did|its|let|put|say|she|too|use|dad|mom|hey|wow|oops|yeah|okay|hello|sorry|please|thank|maybe)\b/gi,
                /\b(ing\b|ed\b|tion\b|ment\b|ness\b|able\b|ible\b|ful\b|less\b|ship\b|hood\b|dom\b)\b/gi
            ];
            
            const persianIndicators = [
                /[\u0600-\u06FF]/g, // Persische Zeichen
                /\b(ŸÖŸÜ|ÿ™Ÿà|ÿßŸà|ŸÖÿß|ÿ¥ŸÖÿß|ÿ¢ŸÜŸáÿß|ÿß€åŸÜ|ÿ¢ŸÜ|ÿ®ŸàÿØ|ÿßÿ≥ÿ™|ÿ¥ÿØ|ÿ®ÿßÿ¥|⁄©ŸÜ|⁄ØŸÅÿ™|⁄©ÿ±ÿØ|ÿ±Ÿà|ÿ®ÿß|ÿßÿ≤|ÿ®Ÿá|ÿØÿ±|ÿ®ÿ±ÿß€å|⁄©Ÿá|⁄ÜŸá|⁄Ü⁄ØŸàŸÜŸá|⁄©ÿ¨ÿß|⁄©€å|⁄Üÿ±ÿß)\b/g
            ];
            
            let germanScore = 0;
            let nonGermanScore = 0;
            
            germanIndicators.forEach(pattern => {
                const matches = text.match(pattern);
                if (matches) germanScore += matches.length;
            });
            
            englishIndicators.forEach(pattern => {
                const matches = text.match(pattern);
                if (matches) nonGermanScore += matches.length * 1.5;
            });
            
            persianIndicators.forEach(pattern => {
                const matches = text.match(pattern);
                if (matches) nonGermanScore += matches.length * 3;
            });
            
            // Berechne Konfidenz
            const totalScore = germanScore + nonGermanScore;
            const confidence = totalScore > 0 ? (germanScore / totalScore) * 100 : 50;
            
            return {
                isGerman: confidence > 70 && germanScore > nonGermanScore * 1.5,
                confidence: Math.round(confidence),
                germanScore,
                nonGermanScore
            };
        }

        // ========= TEXTKORREKTUR =========
        function korrigiereText(text) {
            let korrigiert = text;
            
            // 1. Satzzeichen korrigieren
            korrigiert = korrigiert.replace(/\s+([,.!?;:])/g, "$1");
            korrigiert = korrigiert.replace(/([,.!?;:])([^\s\n])/g, "$1 $2");
            
            // 2. Gro√üschreibung nach Satzende
            korrigiert = korrigiert.replace(/([.!?])\s+([a-z])/g, function(match, p1, p2) {
                return p1 + " " + p2.toUpperCase();
            });
            
            // 3. Typische Fehler korrigieren
            const corrections = [
                [/\bIch\s+will\b/gi, "Ich m√∂chte"],
                [/\bich\s+will\b/g, "ich m√∂chte"],
                [/\bIch\s+brauche\b/gi, "Ich ben√∂tige"],
                [/\bseit\s+(\d+)\s+Jahr\b/gi, "seit $1 Jahren"],
                [/\bwegen\s+dem\b/gi, "wegen des"],
                [/\btrotz\s+dem\b/gi, "trotz des"],
                [/\bwieviel\b/gi, "wie viel"],
                [/\bzwischendurch\s+,\s*/gi, "zwischen durch, "]
            ];
            
            corrections.forEach(([pattern, replacement]) => {
                korrigiert = korrigiert.replace(pattern, replacement);
            });
            
            // 4. Doppelte Leerzeichen entfernen
            korrigiert = korrigiert.replace(/[ \t]{2,}/g, " ");
            
            // 5. Abs√§tze formatieren
            korrigiert = korrigiert.replace(/\n\s*\n/g, "\n\n");
            
            // 6. Kommasetzung bei Haupt- und Nebens√§tzen (vereinfacht)
            korrigiert = korrigiert.replace(/(\w+)\s+(weil|obwohl|damit|dass|wenn|als)\s+/gi, "$1, $2 ");
            
            return korrigiert.trim();
        }

        // ========= INDIVIDUELLE REDEMITTEL =========
        function getPassendeRedemittel(textAnalysis, task) {
            const redemittel = [];
            
            // Basierend auf Textanalyse
            if (textAnalysis.incompleteSentences > 0) {
                redemittel.push({
                    kategorie: "üìù Satzstruktur verbessern",
                    phrases: [
                        "Vervollst√§ndige deine S√§tze mit einem klaren Subjekt und Pr√§dikat.",
                        "Achte auf korrekte Satzzeichen am Ende jedes Satzes.",
                        "Verwende Konjunktionen wie 'weil', 'obwohl', 'damit' f√ºr komplexere S√§tze.",
                        "Vermeide Aufz√§hlungen ohne klare Satzstruktur."
                    ]
                });
            }
            
            if (textAnalysis.logicalConnectors < 3) {
                redemittel.push({
                    kategorie: "üîó Logische Verkn√ºpfungen",
                    phrases: [
                        "Verwende mehr Konnektoren: 'au√üerdem', 'deshalb', 'trotzdem', 'jedoch'.",
                        "Zeige Zusammenh√§nge mit 'einerseits... andererseits...'.",
                        "Begr√ºnde deine Aussagen mit 'daher', 'folglich', 'aus diesem Grund'.",
                        "Stelle Gegens√§tze mit 'obwohl', 'dennoch', 'hingegen' dar."
                    ]
                });
            }
            
            if (textAnalysis.wordCount < 120) {
                redemittel.push({
                    kategorie: "üìà Wortzahl erh√∂hen",
                    phrases: [
                        "F√ºge konkrete Beispiele und Details hinzu.",
                        "Erkl√§re deine Argumente ausf√ºhrlicher.",
                        "Beschreibe die Konsequenzen deiner Vorschl√§ge.",
                        "F√ºge pers√∂nliche Erfahrungen oder Beobachtungen hinzu."
                    ]
                });
            }
            
            if (!textAnalysis.hasIntroduction || !textAnalysis.hasConclusion) {
                redemittel.push({
                    kategorie: "üèóÔ∏è Textstruktur optimieren",
                    phrases: [
                        "Beginne mit einer klaren Einleitung zum Thema.",
                        "Struktur deine Argumente in logischen Abs√§tzen.",
                        "Beende deinen Text mit einer Zusammenfassung oder einem Fazit.",
                        "Verwende √úberleitungen zwischen den Abs√§tzen."
                    ]
                });
            }
            
            // Basierend auf Task
            if (task && task.toLowerCase().includes('brief')) {
                redemittel.push({
                    kategorie: "‚úâÔ∏è Formeller Brief",
                    phrases: [
                        "Beginnen Sie mit 'Sehr geehrte Damen und Herren,' oder einer konkreten Anrede.",
                        "Verwenden Sie h√∂fliche Formulierungen: 'Ich w√§re Ihnen dankbar, wenn...'",
                        "Beenden Sie mit 'Mit freundlichen Gr√º√üen' und Ihrem Namen.",
                        "Stellen Sie klar dar, was Sie erreichen m√∂chten."
                    ]
                });
            }
            
            if (task && (task.toLowerCase().includes('meinung') || task.toLowerCase().includes('argument'))) {
                redemittel.push({
                    kategorie: "üí° Meinungs√§u√üerung",
                    phrases: [
                        "Stellen Sie klar Ihre Position dar: 'Ich bin der Ansicht, dass...'",
                        "Begr√ºnden Sie Ihre Meinung mit konkreten Argumenten.",
                        "Ber√ºcksichtigen Sie auch gegenteilige Standpunkte.",
                        "Fassen Sie Ihre Position am Ende noch einmal zusammen."
                    ]
                });
            }
            
            // Standard-Redemittel falls n√∂tig
            if (redemittel.length < 2) {
                redemittel.push({
                    kategorie: "üéØ Allgemeine Verbesserungen",
                    phrases: [
                        "Verwende pr√§zisere Substantive statt allgemeiner Begriffe.",
                        "Variiere deine Satzanf√§nge f√ºr einen fl√ºssigeren Text.",
                        "Achte auf die korrekte Verwendung von Artikeln und Pr√§positionen.",
                        "√úberpr√ºfe die Rechtschreibung und Kommasetzung."
                    ]
                });
            }
            
            return redemittel.slice(0, 4); // Maximal 4 Kategorien
        }

        // ========= DUALE BEWERTUNG (STRENG) =========
        function dualBewertung(text, task) {
            // Textanalyse durchf√ºhren
            const analysis = analyzeTextStructure(text);
            const taskRelevance = checkTaskRelevance(text, task);
            const wordPenalty = calculateWordPenalty(analysis.wordCount);
            const languageDetection = detectLanguage(text);
            
            // Pr√ºfer A - Sehr streng
            const prueferA = {
                aufgabenbewaeltigung: Math.max(0, Math.floor(taskRelevance * 3) - (analysis.wordCount < 120 ? 1 : 0)),
                kommunikativeAngemessenheit: Math.max(0, (analysis.formalElements > 0 ? 2 : 1) - (analysis.incompleteSentences > 2 ? 1 : 0)),
                textaufbau: Math.max(0, (analysis.hasIntroduction && analysis.hasBody && analysis.hasConclusion ? 2 : 1) - (analysis.paragraphCount < 2 ? 1 : 0)),
                lexikAusdruck: Math.max(0, (analysis.logicalConnectors >= 3 ? 2 : 1) - (analysis.sentencesWithoutVerb > 1 ? 1 : 0)),
                formaleRichtigkeit: Math.max(0, 2 - analysis.incompleteSentences)
            };
            
            // Wortzahl-Strafe anwenden (nur wenn unter 120)
            if (analysis.wordCount < 120) {
                prueferA.aufgabenbewaeltigung = Math.max(0, prueferA.aufgabenbewaeltigung - Math.floor(wordPenalty.penalty));
            }
            
            // Pr√ºfer B - P√§dagogisch, aber fair
            const prueferB = {
                aufgabenbewaeltigung: Math.min(3, Math.ceil(taskRelevance * 2.5)),
                kommunikativeAngemessenheit: Math.min(3, (analysis.formalElements > 0 ? 2 : 1) + (analysis.logicalConnectors >= 2 ? 1 : 0)),
                textaufbau: Math.min(3, (analysis.paragraphCount >= 2 ? 2 : 1) + (analysis.hasConclusion ? 1 : 0)),
                lexikAusdruck: Math.min(3, (analysis.logicalConnectors >= 2 ? 2 : 1) + (analysis.wordCount > 150 ? 1 : 0)),
                formaleRichtigkeit: Math.min(3, 3 - Math.min(2, analysis.incompleteSentences))
            };
            
            // Mildere Wortzahl-Strafe f√ºr Pr√ºfer B
            if (analysis.wordCount < 120) {
                prueferB.aufgabenbewaeltigung = Math.max(0, prueferB.aufgabenbewaeltigung - Math.floor(wordPenalty.penalty * 0.7));
            }
            
            // Sicherstellen, dass Werte im Bereich 0-3 liegen
            Object.keys(prueferA).forEach(key => {
                prueferA[key] = Math.max(0, Math.min(3, prueferA[key]));
                prueferB[key] = Math.max(0, Math.min(3, prueferB[key]));
            });
            
            // Gesamtpunkte berechnen
            const gesamtA = Object.values(prueferA).reduce((a, b) => a + b, 0);
            const gesamtB = Object.values(prueferB).reduce((a, b) => a + b, 0);
            
            // Finale Bewertung (Durchschnitt)
            const final = {
                aufgabenbewaeltigung: Math.round((prueferA.aufgabenbewaeltigung + prueferB.aufgabenbewaeltigung) / 2),
                kommunikativeAngemessenheit: Math.round((prueferA.kommunikativeAngemessenheit + prueferB.kommunikativeAngemessenheit) / 2),
                textaufbau: Math.round((prueferA.textaufbau + prueferB.textaufbau) / 2),
                lexikAusdruck: Math.round((prueferA.lexikAusdruck + prueferB.lexikAusdruck) / 2),
                formaleRichtigkeit: Math.round((prueferA.formaleRichtigkeit + prueferB.formaleRichtigkeit) / 2)
            };
            
            const finalGesamt = Object.values(final).reduce((a, b) => a + b, 0);
            const bestanden = finalGesamt >= 8 && analysis.isComplete;
            
            return {
                prueferA: { ...prueferA, gesamt: gesamtA },
                prueferB: { ...prueferB, gesamt: gesamtB },
                final: { ...final, gesamt: finalGesamt, bestanden },
                analysis,
                taskRelevance,
                wordPenalty,
                languageDetection
            };
        }

        // ========= ERGEBNIS-ANZEIGE =========
        function ergebnisseAnzeigen(result, korrigierterText, passendeRedemittel) {
            // Ergebnisse sichtbar machen
            document.getElementById('results').classList.remove('hidden');
            
            // Erh√∂he Bewertungsz√§hler
            totalEvaluations++;
            localStorage.setItem('totalEvaluations', totalEvaluations);
            document.getElementById('totalEvaluations').textContent = totalEvaluations.toLocaleString();
            
            // Pr√ºfer A Ergebnisse
            const prueferA = result.prueferA;
            document.getElementById('prueferA1').textContent = prueferA.aufgabenbewaeltigung + '/3';
            document.getElementById('prueferA2').textContent = prueferA.kommunikativeAngemessenheit + '/3';
            document.getElementById('prueferA3').textContent = prueferA.textaufbau + '/3';
            document.getElementById('prueferA4').textContent = prueferA.lexikAusdruck + '/3';
            document.getElementById('prueferA5').textContent = prueferA.formaleRichtigkeit + '/3';
            
            // Pr√ºfer A Begr√ºndungen
            document.getElementById('begruendungA').innerHTML = `
                <p class="correction-highlight"><strong>Aufgabenbew√§ltigung (${prueferA.aufgabenbewaeltigung}/3):</strong> ${result.analysis.wordCount} W√∂rter, Aufgabe ${Math.round(result.taskRelevance * 100)}% erf√ºllt</p>
                <p class="correction-highlight"><strong>Kommunikative Angemessenheit (${prueferA.kommunikativeAngemessenheit}/3):</strong> ${result.analysis.formalElements > 0 ? 'Formelle Elemente vorhanden' : 'Fehlen formeller Elemente'}</p>
                <p class="correction-highlight"><strong>Textaufbau (${prueferA.textaufbau}/3):</strong> ${result.analysis.paragraphCount} Abs√§tze, ${result.analysis.hasIntroduction ? 'Einleitung' : 'Keine Einleitung'}, ${result.analysis.hasConclusion ? 'Schluss' : 'Kein Schluss'}</p>
                <p class="correction-highlight"><strong>Lexik & Ausdruck (${prueferA.lexikAusdruck}/3):</strong> ${result.analysis.logicalConnectors} logische Konnektoren, ${result.analysis.sentencesWithoutVerb} S√§tze ohne klare Verbstruktur</p>
                <p class="correction-highlight"><strong>Formale Richtigkeit (${prueferA.formaleRichtigkeit}/3):</strong> ${result.analysis.incompleteSentences} unvollst√§ndige S√§tze, Rechtschreibung und Grammatik bewertet</p>
            `;
            
            // Pr√ºfer B Ergebnisse
            const prueferB = result.prueferB;
            document.getElementById('prueferB1').textContent = prueferB.aufgabenbewaeltigung + '/3';
            document.getElementById('prueferB2').textContent = prueferB.kommunikativeAngemessenheit + '/3';
            document.getElementById('prueferB3').textContent = prueferB.textaufbau + '/3';
            document.getElementById('prueferB4').textContent = prueferB.lexikAusdruck + '/3';
            document.getElementById('prueferB5').textContent = prueferB.formaleRichtigkeit + '/3';
            
            // Pr√ºfer B Empfehlungen
            document.getElementById('begruendungB').innerHTML = `
                <p class="correction-highlight">‚úÖ <strong>St√§rken:</strong> ${result.analysis.wordCount >= 120 ? 'Ausreichende Wortzahl' : 'Text zeigt Potenzial'}, ${result.analysis.logicalConnectors >= 2 ? 'Logische Verkn√ºpfungen erkennbar' : 'Thema grunds√§tzlich behandelt'}</p>
                <p class="correction-highlight">üìà <strong>Entwicklung:</strong> ${result.analysis.wordCount < 120 ? 'Wortzahl erh√∂hen' : 'Inhalt vertiefen'}, ${result.analysis.incompleteSentences > 0 ? 'Satzstrukturen vervollst√§ndigen' : 'Formulierungen variieren'}</p>
                <p class="correction-highlight">üéØ <strong>Fokus f√ºr Pr√ºfung:</strong> ${result.analysis.hasConclusion ? 'Argumente st√§rker ausbauen' : 'Klare Struktur mit Einleitung und Schluss'}, ${result.taskRelevance < 0.7 ? 'Genauer auf Aufgabenstellung eingehen' : 'Sprachliche Feinheiten verbessern'}</p>
                <p class="correction-highlight">üí° <strong>Tipp:</strong> ${result.analysis.wordCount < 120 ? 'Konkrete Beispiele und Details hinzuf√ºgen' : 'Mehr Konnektoren f√ºr bessere Textverbindung verwenden'}</p>
            `;
            
            // Finale Bewertung
            const final = result.final;
            document.getElementById('final1').textContent = final.aufgabenbewaeltigung + '/3';
            document.getElementById('final2').textContent = final.kommunikativeAngemessenheit + '/3';
            document.getElementById('final3').textContent = final.textaufbau + '/3';
            document.getElementById('final4').textContent = final.lexikAusdruck + '/3';
            document.getElementById('final5').textContent = final.formaleRichtigkeit + '/3';
            
            // Wortzahl-Bewertung anzeigen
            const wordEvaluation = document.getElementById('wordCountEvaluation');
            const wordBadge = document.getElementById('wordPenaltyBadge');
            const wordExplanation = document.getElementById('wordCountExplanation');
            
            if (result.analysis.wordCount >= 130) {
                wordEvaluation.textContent = "Ausgezeichnet (‚â•130 W√∂rter)";
                wordBadge.textContent = "‚úÖ Optimal";
                wordBadge.className = "px-3 py-1 rounded-full text-sm font-bold bg-green-500 text-white";
                wordExplanation.textContent = "Ihre Wortzahl ist mehr als ausreichend. Konzentrieren Sie sich auf Inhalt und Qualit√§t.";
            } else if (result.analysis.wordCount >= 120) {
                wordEvaluation.textContent = "Ausreichend (120-129 W√∂rter)";
                wordBadge.textContent = "‚úì OK";
                wordBadge.className = "px-3 py-1 rounded-full text-sm font-bold bg-yellow-500 text-white";
                wordExplanation.textContent = "Sie haben das Minimum erreicht. F√ºr eine bessere Bewertung empfehlen wir 130+ W√∂rter.";
            } else {
                wordEvaluation.textContent = `Zu kurz (${result.analysis.wordCount} W√∂rter)`;
                wordBadge.textContent = `-${result.wordPenalty.penalty} Punkte`;
                wordBadge.className = "px-3 py-1 rounded-full text-sm font-bold bg-red-500 text-white";
                wordExplanation.textContent = `${result.wordPenalty.reason}. Mindestens 120 W√∂rter werden f√ºr eine vollst√§ndige Bewertung ben√∂tigt.`;
            }
            
            document.getElementById('gesamtPunkte').textContent = final.gesamt + '/15 PUNKTE';
            
            const bestandenBox = document.getElementById('bestandenBox');
            const passingNote = document.getElementById('passingNote');
            
            if (final.bestanden) {
                bestandenBox.className = 'bestanden inline-block px-8 py-4 rounded-xl font-bold text-2xl text-white';
                bestandenBox.textContent = '‚úÖ BESTANDEN (mind. 8/15 Punkte erreicht)';
                passingNote.textContent = 'Hinweis: In der realen Pr√ºfung k√∂nnte die Bewertung milder ausfallen.';
            } else {
                bestandenBox.className = 'nicht-bestanden inline-block px-8 py-4 rounded-xl font-bold text-2xl text-white';
                bestandenBox.textContent = '‚ùå NICHT BESTANDEN (unter 8/15 Punkten)';
                
                if (!result.analysis.isComplete) {
                    passingNote.textContent = 'Wichtiger Grund: Der Text wurde als unvollst√§ndig oder nicht ausreichend strukturiert bewertet.';
                } else if (result.analysis.wordCount < 120) {
                    passingNote.textContent = `Wichtiger Grund: Wortzahl (${result.analysis.wordCount}) deutlich unter dem erforderlichen Minimum von 120.`;
                } else {
                    passingNote.textContent = 'Verbessern Sie insbesondere Textaufbau und formale Richtigkeit f√ºr eine bessere Bewertung.';
                }
            }
            
            // Korrigierte Version anzeigen
            document.getElementById('korrigierteVersion').textContent = korrigierterText;
            
            // Passende Redemittel anzeigen
            document.getElementById('redemittel').innerHTML = passendeRedemittel.map(kategorie => `
                <div class="bg-white p-4 rounded-lg border border-teal-200 shadow-sm">
                    <p class="text-teal-800 font-bold mb-2 flex items-center">
                        <span class="bg-teal-100 p-1 rounded mr-2">${kategorie.kategorie.split(' ')[0]}</span>
                        ${kategorie.kategorie}
                    </p>
                    <ul class="text-sm text-gray-700 space-y-2">
                        ${kategorie.phrases.map(phrase => `<li class="flex items-start"><span class="text-teal-500 mr-2">‚Ä¢</span> ${phrase}</li>`).join('')}
                    </ul>
                </div>
            `).join('');
        }

        // ========= HAUPT-BEWERTUNGSFUNKTION =========
        function startBewertung() {
            const text = textInput.value.trim();
            const task = document.getElementById('task').value.trim();
            
            if (!text) {
                alert('Bitte geben Sie einen Text zur Bewertung ein!');
                return;
            }
            
            if (!task || task.length < 10) {
                if (!confirm('Sie haben keine klare Aufgabenstellung eingegeben. Ohne Aufgabe kann die Bewertung der Aufgabenbew√§ltigung nicht pr√§zise erfolgen. Trotzdem fortfahren?')) {
                    return;
                }
            }
            
            // Strenge Sprachpr√ºfung
            const languageDetection = detectLanguage(text);
            if (!languageDetection.isGerman) {
                alert(`ACHTUNG: Der Text scheint nicht auf Deutsch zu sein (Konfidenz: ${languageDetection.confidence}%). Bitte geben Sie einen deutschen Text ein.`);
                document.getElementById('languageWarning').classList.remove('hidden');
                document.getElementById('languageWarning').scrollIntoView({behavior: 'smooth', block: 'center'});
                return;
            }
            
            // Textanalyse f√ºr Unvollst√§ndigkeit
            const analysis = analyzeTextStructure(text);
            
            // Warnung bei unvollst√§ndigem Text
            if (!analysis.isComplete && analysis.wordCount > 50) {
                let reason = '';
                if (analysis.wordCount < 100) reason = `Nur ${analysis.wordCount} W√∂rter (Mindestempfehlung: 120)`;
                else if (analysis.incompleteSentences > analysis.sentenceCount * 0.2) reason = `${analysis.incompleteSentences} unvollst√§ndige S√§tze`;
                else if (!analysis.hasIntroduction || !analysis.hasConclusion) reason = 'Fehlende klare Struktur (Einleitung/Schluss)';
                else reason = 'Text scheint unvollst√§ndig oder abgebrochen';
                
                document.getElementById('incompleteReason').textContent = reason;
                document.getElementById('incompleteWarning').classList.remove('hidden');
                
                if (!confirm('WARNUNG: Der Text wurde als m√∂glicherweise unvollst√§ndig erkannt. Eine vollst√§ndige Bewertung ist eventuell nicht fair m√∂glich. Trotzdem fortfahren?')) {
                    document.getElementById('incompleteWarning').classList.add('hidden');
                    return;
                }
            }
            
            // Button deaktivieren w√§hrend Verarbeitung
            const btn = document.getElementById('bewertenBtn');
            btn.innerHTML = 'üîÑ Beide Pr√ºfer bewerten (streng)...';
            btn.disabled = true;
            
            // Verarbeitung simulieren
            setTimeout(() => {
                const result = dualBewertung(text, task);
                const korrigierterText = korrigiereText(text);
                const passendeRedemittel = getPassendeRedemittel(analysis, task);
                
                ergebnisseAnzeigen(result, korrigierterText, passendeRedemittel);
                
                btn.innerHTML = 'üéØ Jetzt streng bewerten lassen';
                btn.disabled = false;
                
                // Ergebnisse sichtbar machen
                document.getElementById('results').scrollIntoView({ behavior: 'smooth' });
                
                // Warnungen ausblenden
                document.getElementById('incompleteWarning').classList.add('hidden');
                document.getElementById('languageWarning').classList.add('hidden');
            }, 1500);
        }

        // ========= TEXT-EINGABE-√úBERWACHUNG =========
        textInput.addEventListener('input', function() {
            const text = this.value;
            const chars = text.length;
            const words = text.trim() === '' ? 0 : text.trim().split(/\s+/).length;
            const sentences = text.split(/[.!?]+/).filter(s => s.trim().length > 0).length;
            
            // Basis-Statistiken
            charCount.textContent = chars + ' Zeichen';
            wordCount.textContent = words + ' W√∂rter';
            sentenceCount.textContent = sentences + ' S√§tze';
            
            // Wortzahl-Progress-Bar
            let progressPercentage = 0;
            if (words >= 130) {
                progressPercentage = 100;
                wordCountStatus.textContent = 'Ausgezeichnet (‚â•130 W√∂rter)';
                wordCountStatus.className = 'font-bold text-green-600';
                wordPenaltyInfo.classList.add('hidden');
            } else if (words >= 120) {
                progressPercentage = 85 + ((words - 120) / 10 * 15);
                wordCountStatus.textContent = `OK (${words}/120 W√∂rter)`;
                wordCountStatus.className = 'font-bold text-yellow-600';
                wordPenaltyInfo.classList.add('hidden');
            } else if (words >= 100) {
                progressPercentage = 70 + ((words - 100) / 20 * 15);
                wordCountStatus.textContent = `Achtung (${words}/120 W√∂rter)`;
                wordCountStatus.className = 'font-bold text-orange-600';
                wordPenaltyInfo.classList.remove('hidden');
            } else if (words >= 80) {
                progressPercentage = 50 + ((words - 80) / 20 * 20);
                wordCountStatus.textContent = `Zu kurz (${words}/120 W√∂rter)`;
                wordCountStatus.className = 'font-bold text-red-600';
                wordPenaltyInfo.classList.remove('hidden');
            } else if (words >= 60) {
                progressPercentage = 30 + ((words - 60) / 20 * 20);
                wordCountStatus.textContent = `Sehr kurz (${words}/120 W√∂rter)`;
                wordCountStatus.className = 'font-bold text-red-700';
                wordPenaltyInfo.classList.remove('hidden');
            } else if (words > 0) {
                progressPercentage = (words / 60) * 30;
                wordCountStatus.textContent = `Unzureichend (${words}/120 W√∂rter)`;
                wordCountStatus.className = 'font-bold text-red-800';
                wordPenaltyInfo.classList.remove('hidden');
            } else {
                wordCountStatus.textContent = 'Bitte Text eingeben';
                wordCountStatus.className = 'font-bold text-gray-600';
                wordPenaltyInfo.classList.add('hidden');
            }
            
            document.getElementById('wordProgress').style.width = progressPercentage + '%';
            
            // Sprachpr√ºfung
            if (words >= 20) {
                updateLanguageCheck();
            } else {
                languageWarning.classList.add('hidden');
                incompleteWarning.classList.add('hidden');
                languageStatus.textContent = '';
            }
        });

        function updateLanguageCheck() {
            const text = textInput.value || "";
            if (text.trim().length < 20){
                languageWarning.classList.add('hidden');
                languageStatus.textContent = "";
                return;
            }

            const detection = detectLanguage(text);
            
            if (detection.isGerman){
                languageWarning.classList.add('hidden');
                languageStatus.innerHTML = `<span class="text-emerald-600">‚úì Text erkannt als Deutsch (${detection.confidence}% Konfidenz)</span>`;
            } else {
                languageWarning.classList.remove('hidden');
                languageStatus.innerHTML = `<span class="text-rose-600">‚úó Text scheint NICHT Deutsch zu sein (${detection.confidence}% Konfidenz)</span>`;
            }
        }

        // ========= NEUSTART =========
        function neustart() {
            document.getElementById('textInput').value = '';
            document.getElementById('task').value = '';
            document.getElementById('results').classList.add('hidden');
            languageWarning.classList.add('hidden');
            incompleteWarning.classList.add('hidden');
            textInput.dispatchEvent(new Event('input'));
            document.getElementById('bewertenBtn').scrollIntoView({ behavior: 'smooth' });
        }

        // ========= INITIALISIERUNG =========
        document.addEventListener('DOMContentLoaded', function() {
            initStats();
            textInput.dispatchEvent(new Event('input'));
            
            // Beispiel-Text f√ºr Demo (optional)
            // textInput.value = "Sehr geehrte Damen und Herren,\n\nich schreibe Ihnen, weil ich mich √ºber die schlechte Busverbindung in unserer Stadt beschweren m√∂chte. Seit einem Jahr warte ich jeden Morgen mindestens 20 Minuten auf den Bus. Das ist sehr unp√ºnktlich und frustrierend.\n\nEinerseits verstehe ich, dass es manchmal Verkehrsprobleme gibt. Andererseits sollte der Busfahrplan besser organisiert werden. Au√üerdem sind die Busse oft √ºberf√ºllt, besonders morgens zwischen 7 und 8 Uhr.\n\nIch schlage vor, dass Sie mehr Busse in der Hauptverkehrszeit einsetzen. Deshalb bitte ich Sie, diesen Vorschlag zu pr√ºfen.\n\nMit freundlichen Gr√º√üen,\nMax Mustermann";
            // document.getElementById('task').value = "Schreiben Sie einen Beschwerdebrief √ºber die Busverbindung in Ihrer Stadt";
            // textInput.dispatchEvent(new Event('input'));
        });
    </script>
</body>
</html>
